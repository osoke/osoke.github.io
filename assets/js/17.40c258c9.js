(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{406:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("在 Windows 中, 我们都知道: 你可以在文件管理器中 ctrl+c 复制一些文件, 然后切换到别的文件夹中 ctrl+v 粘贴, 文件就被轻松的转移过来了。但是, 我们自己开发的应用, 默认情况下是没有办法这样操作的。不过, 我们可以手动添加这样的功能, 增加我们开发的应用与操作系统之间的互动性")]),s._v(" "),t("p",[s._v("接下来主要介绍如何用 python 读取 Windows 剪贴板数据, 需要用到 ctypes 这个库")]),s._v(" "),t("h2",{attrs:{id:"ctypes-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ctypes-简介"}},[s._v("#")]),s._v(" ctypes 简介")]),s._v(" "),t("p",[s._v("ctypes 是 Python 的外部函数库, 使用它可以方便的调用 c 语言编写的动态链接库函数(dll)")]),s._v(" "),t("h2",{attrs:{id:"读取复制的-text-文本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读取复制的-text-文本"}},[s._v("#")]),s._v(" 读取复制的 text 文本")]),s._v(" "),t("p",[s._v("使用 ctypes, 为了避免类型错误, 一般需要显式声明"),t("strong",[s._v("参数")]),s._v("与"),t("strong",[s._v("返回值")]),s._v("类型")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ctypes  \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wintypes "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" w  \n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 剪贴板数据类型  ")]),s._v("\nCF_UNICODETEXT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unicode 字符  ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------  ")]),s._v("\nu32 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user32    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载 user32   库  ")]),s._v("\nk32 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kernel32  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载 kernel32 库  ")]),s._v("\ns32 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shell32   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载 shell32  库  ")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------  ")]),s._v("\nOpenClipboard "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OpenClipboard  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# func ▶ open 剪贴板  ")]),s._v("\nOpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HWND"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# args (HWND, )  ")]),s._v("\nOpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BOOL     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 -> BOOL  ")]),s._v("\n\nGetClipboardData "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GetClipboardData  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# func ▶ 获取剪贴板数据  ")]),s._v("\nGetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UINT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# args (UINT, )  ")]),s._v("\nGetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HANDLE      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 -> HANDLE  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------  ")]),s._v("\nGlobalLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GlobalLock        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# func ▶ 全局内存锁定  ")]),s._v("\nGlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HGLOBAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# args (HGLOBAL, )  ")]),s._v("\nGlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LPVOID      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 -> LPVOID  ")]),s._v("\n\nGlobalUnlock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GlobalUnlock    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# func ▶ 全局内存解锁  ")]),s._v("\nGlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HGLOBAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# args (HGLOBAL, )  ")]),s._v("\nGlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BOOL      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 -> BOOL  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------  ")]),s._v("\nCloseClipboard "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CloseClipboard  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# func ▶ close 剪贴板  ")]),s._v("\nCloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# args 无  ")]),s._v("\nCloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BOOL      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回 -> BOOL ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_clipboard_text")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取剪贴板-文本"""')]),s._v("  \n    text "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" OpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n        h_clip_mem "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CF_UNICODETEXT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n        text "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wstring_at"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_clip_mem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取内存地址 -> 宽字符 str        ")]),s._v("\n        \n        GlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_clip_mem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n        CloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" text  \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'__main__'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("get_clipboard_text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br")])]),t("h2",{attrs:{id:"读取复制的文件列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读取复制的文件列表"}},[s._v("#")]),s._v(" 读取复制的文件列表")]),s._v(" "),t("p",[s._v("在以上代码基础上, 继续编写代码")]),s._v(" "),t("p",[t("strong",[s._v("首先指定剪贴板数据类型")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("CF_HDROP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件句柄 ▶ 指向 HDROP 这种结构, 通过 DragQueryFile 函数来获得文件信息  ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("加载 DragQueryFileW 函数")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("DragQueryFile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DragQueryFileW "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# func ▶ 获取被拖放文件路径 (unicode 格式)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参数设置")]),s._v("\nDragQueryFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HANDLE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UINT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c_void_p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UINT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("读取剪贴板文件列表")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_clipboard_files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取剪贴板-文件列表"""')]),s._v("  \n    files "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" OpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n        h_hdrop "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CF_HDROP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取剪贴板句柄  ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n            GlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n  \n            file_count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DragQueryFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回剪贴板文件数量  ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 buf ")]),s._v("\n                buf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create_unicode_buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("260")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从'全局内存对象'中提取每个文件的路径 ▶ 存入 buf  ")]),s._v("\n                DragQueryFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sizeof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n                files"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n  \n            GlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n            CloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" files\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h2",{attrs:{id:"在此基础上增加拖拽功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在此基础上增加拖拽功能"}},[s._v("#")]),s._v(" 在此基础上增加拖拽功能")]),s._v(" "),t("p",[s._v("之前写过一篇文章 "),t("a",{attrs:{href:"https://osoke.github.io/blogs/python/2022/20220717_1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Tkinter 借助 windnd 实现拖放文件"),t("OutboundLink")],1),s._v(", 结合本文的读取剪贴板操作, 可以进一步提高桌面应用的易用性; 所以可以将它们整合到一起, 不过在整合过程中, 遇到一点小问题, 在这里记录一下")]),s._v(" "),t("p",[s._v("由于「windnd 拖放操作」和「读取剪贴板」内部都是调用的 ctypes 库, 但是调用 DragQueryFileW 函数的方式不一样, 参数类型不一致, 这就需要调整 DragQueryFileW 函数的参数, 与 windnd 保持一致, 否则会导致类型错误")]),s._v(" "),t("p",[s._v("修改上述代码:")]),s._v(" "),t("p",[t("strong",[s._v("加载 DragQueryFileW 函数")])]),s._v(" "),t("ul",[t("li",[s._v("调整1: 去除 args 类型设置")]),s._v(" "),t("li",[s._v("调整2: 按照 windnd 的逻辑, 获取 handle 数据类型")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" platform  \n\nDragQueryFile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DragQueryFileW \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DragQueryFile.argtypes = [w.HANDLE, w.UINT, ctypes.c_void_p, w.UINT] ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# argtypes 与 windnd 保持一致  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" platform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("architecture"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"32bit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    handle_type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c_ulong  \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" platform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("architecture"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"64bit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    handle_type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c_uint64 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("strong",[s._v("读取剪贴板文件列表")])]),s._v(" "),t("ul",[t("li",[s._v("调整: 在 "),t("code",[s._v("get_clipboard_files()")]),s._v(" 中调用 "),t("code",[s._v("DragQueryFile")]),s._v(" 函数时, 第一个参数需要转换类型 "),t("code",[s._v("handle_type(h_hdrop)")])])]),s._v(" "),t("h2",{attrs:{id:"最后附上完整可运行代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最后附上完整可运行代码"}},[s._v("#")]),s._v(" 最后附上完整可运行代码")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ctypes\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wintypes "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" w\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" platform\n\n\nCF_UNICODETEXT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  \nCF_HDROP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("        \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------")]),s._v("\nu32 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user32    \nk32 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kernel32  \ns32 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shell32   \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------")]),s._v("\nOpenClipboard "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OpenClipboard  \nOpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HWND"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   \nOpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BOOL     \n\nGetClipboardData "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GetClipboardData  \nGetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UINT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("      \nGetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HANDLE      \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------")]),s._v("\nGlobalLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GlobalLock        \nGlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HGLOBAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   \nGlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LPVOID      \n\nGlobalUnlock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GlobalUnlock    \nGlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HGLOBAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nGlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BOOL      \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------")]),s._v("\nCloseClipboard "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CloseClipboard  \nCloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argtypes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("       \nCloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("restype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BOOL      \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------------")]),s._v("\nDragQueryFile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DragQueryFileW \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" platform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("architecture"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"32bit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    handle_type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c_ulong\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" platform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("architecture"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"64bit"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    handle_type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c_uint64\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_clipboard_text")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取剪贴板-文本"""')]),s._v("\n    text "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" OpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        h_clip_mem "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CF_UNICODETEXT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        text "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wstring_at"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_clip_mem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n        GlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_clip_mem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        CloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" text\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_clipboard_files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取剪贴板-文件列表"""')]),s._v("\n    files "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" OpenClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        h_hdrop "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GetClipboardData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CF_HDROP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            GlobalLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            file_count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DragQueryFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("handle_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                buf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create_unicode_buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("260")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                DragQueryFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("handle_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ctypes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sizeof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n                files"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            GlobalUnlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_hdrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            CloseClipboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" files\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'__main__'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("get_clipboard_text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# print(get_clipboard_files())")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br")])]),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.python.org/3/library/ctypes.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ctypes 官方文档"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://stackoverflow.com/questions/46132401/read-text-from-clipboard-in-windows-using-ctypes",target:"_blank",rel:"noopener noreferrer"}},[s._v("StackOverflow"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);